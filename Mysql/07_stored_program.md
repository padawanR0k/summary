## Index
- 인덱스(색인)의 사전적의미
	- 색인(索引)은 책 속의 낱말이나 구절, 또 이에 관련한 지시자를 찾아보기 쉽도록 일정한 순서로 나열한 목록을 가리킨다. 인덱스(index)라고도 한다.
- 어떤 책들은 특정단어를 빨리 찾는걸 도와주기 위해 책 뒷부분에 <찾아보기>페이지들을 둔다. 데이터베이스에서도 특정데이터를 효율적으로 적은 리소스로 빨리 찾기위해 index를 생성할 수 있다. 그러나 index를 제대로 이해하지않고 남용하게되면 오히려 성능이 악화될 수도 있다
- 장점
	- 속도 개선
- 단점
	- 약 10%의 추가 공간 필요
	- 첫 인덱스 생성시 시간소요
	- row를 자주 변경하면 오히려 성능악화 초래

### MySQL 인덱스의 종류
- 클러스터형
	- ex) 영어사전
- 보조
	- ex) 책뒤의 <찾아보기>
> 튜닝?
데이터베이스의 성능을 개선시키는 전반적인 방법론을 말한다. index를 사용하여 속도를 개선하는것도 하나의 튜닝이다. 하지만 속도를 위해 서버에 부하량을 너무 많이 늘리게되면 전체적인 서버스의 속도가 나빠질 수도있다.

### 자동생성 인덱스
- 인덱스는 하나의 컬럼에 N개의 인덱스를 생성할 수 있다.
- PK로 설정한 컬럼은 자동으로 클러스터형 인덱스가 생성된다.
	- 그래서, 기존에 수백만 건의 데이터가 이미 존재할 때 PK를 변경하게되면 인덱스가 다시 만들어지는 작업을 하게되어 엄청나게 많은 작업이 수행된다.
	- 또한 PK기준으로 테이블의 데이터가 ASC 정렬된다.
- UQ로 설정한 컬럼은 자동으로 보조 인덱스가 생성된다. (만약 NN 제약조건을  추가하면 클러스터형 인덱스로 지정된다.)

### 인덱스 내부 작동
- B-Tree (Balanced Tree)
	- 자료구조에서 범용적으로 사용되는 구조
	- MySQL에서 B-Tree를 사용할 때 노드의 단위를 Page로 사용한다. (16Kbyte크기의 최소 저장단위)
		- `SHOW VARIABLES LIKE 'innodb_page_size';`로 확인가능
	- B-Tree는 루트 노드와 루트노드 하위에 리프 노드(여기서는 리프페이지)를 가지고 있다. 검색할 때(SELECT), 인덱스로 인해 정렬된 리프페이지가 존재하면 모든 데이터를 확인하지않게 도와주기 때문에 시간비용이 줄어든다.
	- 데이터의 변경 작업은 왜 느려질까?
		- 페이지 분할때문이다. 리프페이지들은 저장 단위를 넘어가게 되면 새로운 리프페이지를 만들고 데이터들을 다시 정리하게 된다. 이때, 이동되는 데이터가 많아지기 때문에 성능에 영향이 간다.

### 클러스터형 인덱스 vs 보조 인덱스
- 클러스터형
	- 데이터가 "정렬"되어 있어야한다. -> 추가, 삭제시 재졍렬해야한다
	- 정렬되어있기 때문에 검색시 보조인덱스 보다 더 빠르다.
	- 인덱스 페이지에 데이터의주소가 포함되어있다.
- 보조
	- 데이터가 정렬되어있지 않아도된다. -> 클러스터형보다 추가, 삭제시 성능부하가 적다.

### 혼합하여 사용시
1. 보조인덱스에서 일치하는 값을 찾는다.
2. 일치하는 값의 클러스터형 인덱스키 값을 가진채로 다시 클러스터형 인데스페이지의 루트페이지로 간다
3. 클러스터형 인덱스 키값으로 값을 찾아나간다
> 보조인덱스에서 클러스터형 인덱스키를 다시 찾는 이유?
클러스터형 페이지의 주소값은 데이터 수정시 정렬이 발생하는 경우 변하기 때문에 수정해야할 데이터가 많아지는 단점이있어서


### 인덱스 생성, 삭제
```sql
CREATE INDEX <인덱스명> ON <테이블명> ( 칼럼명1, 칼럼명2, ... );

ALTER TABLE <테이블명> DROP INDEX <인덱스명>;
```
- 인덱스에도 각 상황에 맞는 옵션이 존재한다. (알고리즘이나 자료구조 등을 변경시킬수 있다) 이 부분은 본인이 다루는 데이터에 따라 설정하면된다. (전문적으로 다루는 팀원에게 요청하는것이 맞을듯함)

### 인덱스 실무
- 잘못된 보조인덱스 사용으로인해 테이블 전체의 15%이상을 스캔하려고 하게되면, mysql 자체에서 스캔방식을 일반 테이블 스캔으로 변경함
- WHERE절이 많이 사용 되는 컬럼에 인덱스를 만들어야 효율적이다. 또한 AND, OR등을 사용하는 경우 인덱스를 타게끔 작성해야한다.
- 컬럼의 데이터가 카디널리티가 높아야 효과가 높다 ex) 주민번호
- 외래 키를 지정한 열에는 자동으로 외래키 인덱스가 생성된다.
- SELECT의 성능향상, INSERT/UPDATE/DELETE의 성능악화 가 적용되도 괜찮은 테이블에 적용해야한다.
- 클러스터형 인덱스는 테이블당 1개가능, 정렬되어 있기때문에 BETWEEN, ORDER BY절에 성능이 우수함
- 사용하지 않는 인덱스는 제거하자


##### 참고
- [인덱스란?](https://jojoldu.tistory.com/243)